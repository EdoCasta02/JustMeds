<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JustMeds</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="../index.html">
                    <img src="../images/Logo.png" alt="Logo" width="40" height="40">
                </a>
                <a class="navbar-brand" href="../index.html">JustMeds</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav me-auto">
                        <a class="nav-link active" aria-current="page" href="../index.html">Home</a>
                        <a class="nav-link" href="../about_us/about.html">Chi siamo</a>
                    </div>
                    <div class="navbar-nav">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#accountModal">
                            <i class="fas fa-user-circle" style="font-size: 30px;"></i>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="container mt-4">
      <h2>Ordini disponibili</h2>
      <div id="ordersContainer" class="card-deck mt-3"></div>
      <div id="map" class="map-container" style="height: 400px; margin-top: 20px;"></div>
  </div>
  
  <script>
    let isOrderAccepted = false;
    const cancelButton = document.createElement("button");
    
    document.addEventListener("DOMContentLoaded", async () => {
            try {
                const response = await fetch("/api/orders");
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                const orders = await response.json();
                const ordersContainer = document.getElementById("ordersContainer");

                const confirmedOrders = orders.filter(order => order.stato === 'confermato');

                if (confirmedOrders.length === 0) {
                    const noOrdersMessage = document.createElement("p");
                    noOrdersMessage.textContent = "Nessun ordine disponibile per il ritiro...";
                    ordersContainer.appendChild(noOrdersMessage);
                } else {
                    confirmedOrders.forEach((order, orderIndex) => {
                    const orderCard = document.createElement("div");
                    orderCard.classList.add("card", "mb-3");

                    const cardBody = document.createElement("div");
                    cardBody.classList.add("card-body");

                    const title = document.createElement("h5");
                    title.classList.add("card-title");
                    title.textContent = `Ordine #${order._id}`;
                    cardBody.appendChild(title);

                    const productList = document.createElement("ul");
                    productList.classList.add("list-group", "list-group-flush");

                    let productCounter = 1;

                    order.prodotti.forEach((product) => {
                        const productItem = document.createElement("li");
                        productItem.classList.add("list-group-item");
                        productItem.textContent = `Farmaco ${productCounter} - Quantità: ${product.quantita} - Prezzo unitario: €${product.prezzo}`;
                        productList.appendChild(productItem);
                        productCounter++;
                    });

                    cardBody.appendChild(productList);

                    const totalPrice = document.createElement("p");
                    totalPrice.classList.add("card-text", "mt-2");
                    totalPrice.innerHTML = `<strong>Prezzo Totale:</strong> €${order.prodotti.reduce((acc, item) => acc + (item.quantita * item.prezzo), 0)}`;
                    cardBody.appendChild(totalPrice);

                    const pickupAddress = document.createElement("p");
                    pickupAddress.classList.add("card-text");
                    pickupAddress.innerHTML = `<strong>Indirizzo di ritiro:</strong> ${order.indirizzoFarmacia.via}, ${order.indirizzoFarmacia.cap} ${order.indirizzoFarmacia.provincia}`;

                    const deliveryAddress = document.createElement("p");
                    deliveryAddress.classList.add("card-text");
                    deliveryAddress.innerHTML = `<strong>Indirizzo di consegna:</strong> ${order.indirizzoCliente.via}, ${order.indirizzoCliente.cap} ${order.indirizzoCliente.città}`;

                    cardBody.appendChild(pickupAddress);
                    cardBody.appendChild(deliveryAddress);

                    // Pulsante per visualizzare i dettagli
                    const detailsButton = document.createElement("button");
                    detailsButton.classList.add("btn", "btn-primary", "mt-2");
                    detailsButton.textContent = "Visualizza dettagli";
                    detailsButton.onclick = () => {
                        window.location.href = `delivery_management.html`;
                    };

                    cardBody.appendChild(detailsButton);
                    orderCard.appendChild(cardBody);
                    ordersContainer.appendChild(orderCard);
                        });
                    }
                } catch (error) {
                console.error("Errore nel caricare gli ordini:", error);
            }
    });
    
  </script>
  



    <!-- POPUP PER LA GESTIONE DELL'ACCOUNT -->
    <div class="modal fade" id="accountModal" tabindex="-1" aria-labelledby="accountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="accountModalLabel">Il tuo Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Ordini accettati:</strong> 5</p>
                    <p><strong>Soldo guadagnati:</strong> €50</p>
                    <div class="d-grid">
                    <button class="btn btn-secondary mb-2" onclick="window.location.href='delivery_management.html'">Visualizza Ordini Accettati</button>
                    <button class="btn btn-danger" onclick="window.location.href='/logout'">Logout</button>
                  </div>
                </div>
            </div>
        </div>
    </div>


    <footer style="background-color: gray;">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <p>&copy; 2024 JustMeds. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</body>
</html>
